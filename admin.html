<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Krakatau Andover Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.6/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
            font-family: 'Inter', sans-serif;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .header > div {
            flex: 1;
        }

        .header > div:last-child {
            text-align: right;
        }

        .status-connected {
            background: #28a745;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            display: inline-block;
        }

        .status-disconnected {
            background: #dc3545;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            display: inline-block;
        }

        .waypoinnt {
            font-size: 14px;
            color: #ffeb3b;
            font-weight: 600;
            margin-top: 10px;
        }

        .card-custom {
            background: white;
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .card-title {
            font-weight: 700;
            color: #333;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .image-placeholder {
            width: 100%;
            height: 250px;
            border-radius: 8px;
            background: #f0f0f0;
            object-fit: cover;
            display: block;
            margin-bottom: 10px;
        }

        #gpsCanvas {
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            cursor: grab;
            max-width: 100%;
            height: auto;
        }

        #gpsCanvas:active {
            cursor: grabbing;
        }

        .vehicle-data {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            height: 100%;
        }

        .vehicle-data .text-center {
            padding: 10px;
            border-bottom: 1px solid #eee;
            margin-bottom: 8px;
        }

        .vehicle-data .text-center:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .vehicle-data i {
            color: #667eea;
            font-size: 16px;
        }

        .vehicle-data b {
            color: #333;
            display: block;
            margin: 4px 0;
            font-size: 11px;
        }

        .vehicle-data span {
            color: #667eea;
            font-weight: 600;
            font-size: 13px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .form-control, .form-select {
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-control:focus, .form-select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .container-fluid {
            padding: 0 40px;
            max-width: 100%;
        }

        .row {
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
        }

        .col-row-3 {
            flex: 0 0 calc(33.333% - 14px);
            padding: 0 !important;
        }

        .col-row-4 {
            flex: 0 0 calc(25% - 15px);
            padding: 0 !important;
        }

        @media (max-width: 1200px) {
            .col-row-3 {
                flex: 0 0 calc(33.333% - 14px);
            }

            .col-row-4 {
                flex: 0 0 calc(25% - 15px);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 10px;
                margin: 10px 20px;
            }

            .header > div:last-child {
                text-align: center;
            }

            .row {
                flex-direction: column;
                gap: 15px;
            }

            .col-row-3, .col-row-4 {
                flex: 0 0 100% !important;
            }

            .container-fluid {
                padding: 0 20px;
            }
        }

        .btn-group-control {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .form-label {
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .text-muted {
            font-size: 12px;
            margin-bottom: 8px;
            display: block;
        }

        #canvasContainer {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f9f9f9;
            border-radius: 8px;
            padding: 10px;
            min-height: 300px;
            flex-grow: 1;
        }

        #canvasContainer canvas {
            max-width: 100%;
            height: auto;
        }

        .card-body-flex {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .form-scroll {
            flex: 1;
            overflow-y: auto;
            max-height: calc(100% - 80px);
        }

        .control-panel-scroll {
            max-height: 450px;
            overflow-y: auto;
            padding-right: 10px;
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>

<body x-data="x_data()" x-init="init()">
    <!-- HEADER -->
    <div class="header">
        <div>
            <strong><i class="fas fa-ship me-2"></i>KRAKATAU ANDOVER</strong>
            <template x-if="vehicleData.app_connect">
                <span class="status-connected"><i class="fas fa-wifi me-1"></i>CONNECTED</span>
            </template>
            <template x-if="!vehicleData.app_connect">
                <span class="status-disconnected"><i class="fas fa-exclamation-circle me-1"></i>DISCONNECTED</span>
            </template>
            <div class="waypoinnt" x-show="currentMode === 'control'">
                <i class="fas fa-flag me-1"></i>Current Waypoint: <span x-text="vehicleData.current_wp"></span>
            </div>
        </div>
        <div>
            <span x-text="currentMode === 'monitoring' ? 'ðŸ” MONITORING MODE' : 'âš™ï¸ CONTROL MODE'" class="me-3"></span>
            <i class="fas fa-university me-2"></i>UNIVERSITAS TEKNOKRAT INDONESIA
            <button class="btn btn-sm btn-danger ms-3" @click="logout()">
                <i class="fas fa-sign-out-alt me-1"></i>Logout
            </button>
        </div>
    </div>

    <div class="container-fluid">
        <!-- ROW 1: 3 COLUMNS (CAMERAS & TRAJECTORY) -->
        <div class="row">
            <!-- Surface Camera -->
            <div class="col-row-3">
                <div class="card-custom p-3">
                    <div class="card-title"><i class="fas fa-video me-2"></i>SURFACE CAMERA STREAM</div>
                    <div class="card-body-flex">
                        <img :key="surfaceCamera.refreshStream" class="image-placeholder" 
                            :src="surfaceCamera.streamUrl" alt="Surface Camera" />
                        <div class="form-scroll">
                            <label for="waypoint" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>Waypoint to Capture
                            </label>
                            <small class="text-muted">
                                Waypoint list: <strong x-text="surfaceCamera.waypointsText || 'None'"></strong>
                            </small>
                            <div class="d-flex flex-wrap gap-2 mb-3">
                                <input id="waypoint" class="form-control flex-grow-1" type="text"
                                    x-model="surfaceCamera.waypointsText" placeholder="e.g., 1 2 3 4" />
                                <button @click="saveSurfaceWaypoints()" type="button" class="btn btn-sm btn-primary"
                                    title="Save Waypoints"><i class="fas fa-save"></i></button>
                            </div>
                            <div class="btn-group-control">
                                <button @click="startSurfaceCamera()" type="button" class="btn btn-sm btn-success flex-grow-1"
                                    title="Start Camera"><i class="fas fa-play me-1"></i>Start</button>
                                <button @click="stopSurfaceCamera()" type="button" class="btn btn-sm btn-warning flex-grow-1"
                                    title="Stop Camera"><i class="fas fa-stop me-1"></i>Stop</button>
                                <button @click="captureSurfaceImage()" type="button" class="btn btn-sm btn-info flex-grow-1"
                                    title="Capture Image"><i class="fas fa-camera me-1"></i>Capture</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Underwater Camera -->
            <div class="col-row-3">
                <div class="card-custom p-3">
                    <div class="card-title"><i class="fas fa-water me-2"></i>UNDERWATER CAMERA STREAM</div>
                    <div class="card-body-flex">
                        <img class="image-placeholder" :src="underwaterCamera.streamUrl"
                            alt="Underwater Camera" />
                        <div class="form-scroll">
                            <label for="waypoint2" class="form-label">
                                <i class="fas fa-map-marker-alt me-1"></i>Waypoint to Capture
                            </label>
                            <small class="text-muted">
                                Waypoint list: <strong x-text="underwaterCamera.waypointsText || 'None'"></strong>
                            </small>
                            <div class="d-flex flex-wrap gap-2 mb-3">
                                <input id="waypoint2" class="form-control flex-grow-1" type="text"
                                    placeholder="e.g., 1 2 3 4" x-model="underwaterCamera.waypointsText" />
                                <button @click="saveUnderwaterWaypoints()" type="button" class="btn btn-sm btn-primary"
                                    title="Save Waypoints"><i class="fas fa-save"></i></button>
                            </div>
                            <div class="btn-group-control">
                                <button @click="startUnderwaterCamera()" type="button" class="btn btn-sm btn-success flex-grow-1"
                                    title="Start Camera"><i class="fas fa-play me-1"></i>Start</button>
                                <button @click="stopUnderwaterCamera()" type="button" class="btn btn-sm btn-warning flex-grow-1"
                                    title="Stop Camera"><i class="fas fa-stop me-1"></i>Stop</button>
                                <button @click="captureUnderwaterImage()" type="button" class="btn btn-sm btn-info flex-grow-1"
                                    title="Capture Image"><i class="fas fa-camera me-1"></i>Capture</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trajectory -->
            <div class="col-row-3">
                <div class="card-custom p-3">
                    <div class="card-title"><i class="fas fa-map-marked-alt me-2"></i>GPS TRAJECTORY</div>
                    <div id="canvasContainer">
                        <canvas id="gpsCanvas" width="300" height="300"></canvas>
                    </div>
                    <div class="text-center mt-3">
                        <template x-if="!gpsTracker.isTracking">
                            <button @click="startGPSTracking()" class="btn btn-success btn-sm me-2">
                                <i class="fas fa-play me-1"></i>START
                            </button>
                        </template>
                        <template x-if="gpsTracker.isTracking">
                            <button @click="stopGPSTracking()" class="btn btn-warning btn-sm me-2">
                                <i class="fas fa-stop me-1"></i>STOP
                            </button>
                        </template>
                        <button @click="clearGPSPath()" class="btn btn-danger btn-sm">
                            <i class="fas fa-trash me-1"></i>CLEAR
                        </button>
                    </div>
                    <div class="text-center mt-2">
                        <strong x-text="gpsTracker.isTracking ? 
                            'ðŸŸ¢ Tracking Active' : 
                            'âšª Ready to Start'">
                        </strong>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 2: 4 COLUMNS (DATA & IMAGES & CONTROL) -->
        <div class="row">
            <!-- Vehicle Data -->
            <div class="col-row-4">
                <div class="vehicle-data">
                    <div class="card-title"><i class="fas fa-tachometer-alt me-2"></i>VEHICLE DATA</div>
                    <div class="text-center">
                        <i class="fas fa-clock"></i>
                        <b>Time</b>
                        <span x-text="currentTime"></span>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-calendar"></i>
                        <b>Date</b>
                        <span x-text="currentDate"></span>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-crosshairs"></i>
                        <b>Latitude</b>
                        <span x-text="vehicleData.lat.toFixed(6)"></span>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-crosshairs"></i>
                        <b>Longitude</b>
                        <span x-text="vehicleData.long.toFixed(6)"></span>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-compass"></i>
                        <b>Yaw</b>
                        <span x-text="vehicleData.yaw.toFixed(2) + 'Â°'"></span>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-balance-scale"></i>
                        <b>Roll</b>
                        <span x-text="vehicleData.roll.toFixed(2) + 'Â°'"></span>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-battery-three-quarters"></i>
                        <b>Battery</b>
                        <span x-text="vehicleData.battery.toFixed(2) + '%'"></span>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-cog"></i>
                        <b>Mode</b>
                        <span x-text="vehicleData.mode || 'N/A'"></span>
                    </div>
                </div>
            </div>

            <!-- Surface Image -->
            <div class="col-row-4">
                <div class="card-custom p-3">
                    <div class="card-title"><i class="fas fa-image me-2"></i>SURFACE IMAGE</div>
                    <img class="image-placeholder" :src="surfaceCamera.image" alt="Surface Image" />
                </div>
            </div>

            <!-- Underwater Image -->
            <div class="col-row-4">
                <div class="card-custom p-3">
                    <div class="card-title"><i class="fas fa-water me-2"></i>UNDERWATER IMAGE</div>
                    <img class="image-placeholder" :src="underwaterCamera.image" alt="Underwater Image" />
                </div>
            </div>

            <!-- Control Panel -->
            <div class="col-row-4">
                <div class="card-custom p-3">
                    <div class="card-title"><i class="fas fa-cogs me-2"></i>CONTROL PANEL</div>
                    <div class="control-panel-scroll">
                        <form>
                            <div class="mb-3">
                                <label for="ipAddress" class="form-label">
                                    <i class="fas fa-network-wired me-1"></i>IP Address
                                </label>
                                <input type="text" class="form-control" id="ipAddress" x-model="ipAddress"
                                    placeholder="192.168.1.100" />
                            </div>
                            <div class="mb-3">
                                <label for="port" class="form-label">
                                    <i class="fas fa-plug me-1"></i>Port
                                </label>
                                <input type="text" class="form-control" id="port" x-model="port" placeholder="/dev/pixhawk" />
                            </div>
                            <div class="mb-3">
                                <label for="baudrate" class="form-label">
                                    <i class="fas fa-tachometer-alt me-1"></i>Baudrate
                                </label>
                                <select class="form-select" id="baudrate" x-model="baudrate">
                                    <option value="9600">9600</option>
                                    <option value="19200">19200</option>
                                    <option value="38400">38400</option>
                                    <option value="57600">57600</option>
                                    <option value="115200">115200</option>
                                </select>
                            </div>
                            <div class="btn-group-control mb-3">
                                <button type="button" class="btn btn-sm btn-primary flex-grow-1" @click="connectGcs()">
                                    <i class="fas fa-link me-1"></i>Connect
                                </button>
                                <button type="button" class="btn btn-sm btn-danger flex-grow-1" @click="disconnectGcs()">
                                    <i class="fas fa-unlink me-1"></i>Disconnect
                                </button>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="getRealtimeData" x-model="realtimeData" />
                                <label class="form-check-label" for="getRealtimeData">
                                    <i class="fas fa-sync-alt me-1"></i>Realtime Data
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.14.8/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="script.js"></script>
</body>

</html>
